<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FemTube - –ì–ª–∞–≤–Ω–∞—è</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å—Ç–∏–ª–∏ (Tailwind) –∏ –±–∞–∑—É (Supabase) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        /* –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è */
        .video-card .delete-btn { opacity: 0; transition: opacity 0.2s; }
        .video-card:hover .delete-btn { opacity: 1; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <nav class="bg-white border-b sticky top-0 z-50 px-4 py-3 flex justify-between items-center shadow-sm">
        <h1 class="text-xl font-bold text-red-600 flex items-center gap-2 cursor-pointer" onclick="location.reload()">
            <span class="bg-red-600 text-white px-2 py-1 rounded-lg">‚ñ∂</span> FemTube
        </h1>
        <a href="upload.html" class="bg-red-600 text-white px-5 py-2 rounded-full font-medium hover:bg-red-700 transition shadow-md">
            + –î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ
        </a>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="max-w-7xl mx-auto p-6">
        <!-- –°–µ—Ç–∫–∞ –≤–∏–¥–µ–æ -->
        <div id="videoGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- –°—é–¥–∞ –∫–æ–¥ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å –≤–∏–¥–µ–æ–∫–∞—Ä—Ç–æ—á–∫–∏ -->
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –ø—É—Å—Ç–æ -->
        <div id="emptyState" class="hidden text-center py-20">
            <div class="text-6xl mb-4">üì∫</div>
            <h2 class="text-2xl font-bold text-gray-700">–í–∏–¥–µ–æ –ø–æ–∫–∞ –Ω–µ—Ç</h2>
            <p class="text-gray-500 mt-2">–ë—É–¥—å –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É!</p>
        </div>
    </main>

    <script>
        // === –ù–ê–°–¢–†–û–ô–ö–ò (–ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–ò) ===
        const SUPABASE_URL = 'https://yxrvnhytthnsywxxscql.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl4cnZuaHl0dGhuc3l3eHhzY3FsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NTk5NDksImV4cCI6MjA4MzAzNTk0OX0.0LlOI9ttjq-TK3nbVp6j9IVplLBw2tkToR9tESBT8O0';
        const ADMIN_PASSWORD = "SammyAdminAbuseKarapuse"; // –¢–≤–æ–π –ø–∞—Ä–æ–ª—å –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadVideos() {
            try {
                const grid = document.getElementById('videoGrid');
                const empty = document.getElementById('emptyState');

                // 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã 'videos'
                const { data: videos, error } = await supabaseClient
                    .from('videos')
                    .select('*')
                    .order('id', { ascending: false });

                if (error) throw error;

                // 2. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ—Ç ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π —ç–∫—Ä–∞–Ω
                if (!videos || videos.length === 0) {
                    grid.innerHTML = '';
                    empty.classList.remove('hidden');
                    return;
                }

                empty.classList.add('hidden');
                grid.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É –ø–µ—Ä–µ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π

                // 3. –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
                videos.forEach(video => {
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –∏–∑ —Å—Å—ã–ª–∫–∏ (–Ω—É–∂–Ω–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ Storage)
                    const fileName = video.video_url.split('/').pop();

                    grid.innerHTML += `
                        <div class="video-card bg-white rounded-xl shadow-sm border overflow-hidden relative group transition hover:shadow-md">
                            
                            <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
                            <button onclick="deleteVideo('${video.id}', '${fileName}')" 
                                    class="delete-btn absolute top-2 right-2 bg-black/60 hover:bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center z-10">
                                üóë
                            </button>

                            <!-- –ü–ª–µ–µ—Ä -->
                            <div class="aspect-video bg-black">
                                <video src="${video.video_url}" controls class="w-full h-full"></video>
                            </div>

                            <!-- –ò–Ω—Ñ–æ -->
                            <div class="p-3">
                                <h3 class="font-bold text-gray-900 line-clamp-2 leading-tight">${video.title}</h3>
                                <p class="text-gray-500 text-xs mt-2 flex items-center gap-1">
                                    <span class="w-2 h-2 bg-green-500 rounded-full"></span> –î–æ—Å—Ç—É–ø–Ω–æ –ø—É–±–ª–∏—á–Ω–æ
                                </p>
                            </div>
                        </div>
                    `;
                });

            } catch (err) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", err);
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å (F12).");
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è
        async function deleteVideo(id, fileName) {
            // –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–∞—Ä–æ–ª—å
            const pass = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:");
            if (pass !== ADMIN_PASSWORD) return alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");

            if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –≤–∏–¥–µ–æ –Ω–∞–≤—Å–µ–≥–¥–∞?")) return;

            try {
                // 1. –£–¥–∞–ª—è–µ–º –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
                const { error: dbError } = await supabaseClient
                    .from('videos')
                    .delete()
                    .eq('id', id);

                if (dbError) throw dbError;

                // 2. –£–¥–∞–ª—è–µ–º —Å–∞–º —Ñ–∞–π–ª –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (Storage)
                const { error: storageError } = await supabaseClient.storage
                    .from('media')
                    .remove([fileName]);

                // 3. –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                alert("–í–∏–¥–µ–æ —É–¥–∞–ª–µ–Ω–æ");
                loadVideos();

            } catch (err) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:", err);
                alert("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: " + err.message);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadVideos();
    </script>

</body>
</html>